<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π</title>
    <style>
        button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</h1>
    <div id="presentations"></div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
        fetch('/api/presentations')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('presentations');
                data.forEach(p => {
                    const presDiv = document.createElement('div');
                    presDiv.innerHTML = `
                        <h3>${p.title}</h3>
                        <p><strong>–ê–≤—Ç–æ—Ä:</strong> ${p.authorName || "–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}</p>
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${p.description}</p>
                        <p><strong>–î–∞—Ç–∞:</strong> ${p.uploadDate}</p>
                        <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ${p.rating}</p>
                        <button onclick="rate('${p.id}', 1)">üëç</button>
                        <button onclick="rate('${p.id}', -1)">üëé</button>
                        <hr>
                    `;
                    container.appendChild(presDiv);
                });
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π:', error));

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        function rate(id, delta) {
            fetch(`/api/presentations/${id}/rate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ delta })
            })
            .then(response => response.json())
            .then(data => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                alert(`–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${data.rating}`);
                // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                location.reload();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
            });
        }
    </script>
</body>
</html>
